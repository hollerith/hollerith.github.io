<!doctype html>
<html>
<head>
    <title>Health App</title>
    <meta name="viewport" content="width=device-width, user-scalable=no" />

    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="icons/icon-192x192.png" type="image/png" />
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-icon-167x167.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-icon-152x152.png">

    <link rel="stylesheet" type="text/css" href="main.css">
    <script src="newt.js"></script>
    
    <script>
        var App = {
            $app: true,
            id: "app",
            _apiKey: "lX4b8R4X5ath3FaqBG0SXw==AJliNSz4wY2JiEcY",
            _activeTab: "recipe",
            _searchQuery: "",
            _searchResults: [],
            _search: function() {
                let endpoint = "";
                switch (this._activeTab) {
                    case "recipe":
                        endpoint = `https://api.api-ninjas.com/v1/recipe?query=${encodeURIComponent(this._searchQuery)}`;
                        break;
                    case "nutrition":
                        endpoint = `https://api.api-ninjas.com/v1/nutrition?query=${encodeURIComponent(this._searchQuery)}`;
                        break;
                    case "exercises":
                        endpoint = `https://api.api-ninjas.com/v1/exercises?name=${encodeURIComponent(this._searchQuery)}`;
                        break;
                    case "caloriesburned":
                        endpoint = `https://api.api-ninjas.com/v1/caloriesburned?activity=${encodeURIComponent(this._searchQuery)}`;
                        break;
                    default:
                        return;
                }
                fetch(endpoint, {
                    headers: {
                        "X-Api-Key": this._apiKey
                    }
                })
                .then(response => response.json())
                .then(data => {
                    this._searchResults = data;
                })
                .catch(error => {
                    console.error("Error:", error);
                });
            },
            $update: function() {
                const resultsComponent = document.getElementById("search-results");
                resultsComponent.$nodes = this._searchResults.map(result => ({
                    $type: "div",
                    $text: JSON.stringify(result) // This will need to be formatted for display
                }));
                // Re-render the results component
                resultsComponent._update();
            },            
            $nodes: [
                {
                    $type: "input",
                    placeholder: "Search...",
                    $events: {
                        input: function(e) {
                            App._searchQuery = e.target.value;
                        }
                    },
                },
                {
                    $type: "button",
                    $text: "Search Recipe",
                    onclick: function () {
                        App._activeTab = "recipe";
                        App._search();
                    }
                },
                {
                    $type: "button",
                    $text: "Search Nutrition",
                    onclick: function () {
                        App._activeTab = "nutrition";
                        App._search();
                    }
                },
                {
                    $type: "button",
                    $text: "Search Exercises",
                    onclick: function () {
                        App._activeTab = "exercises";
                        App._search();
                    }
                },
                {
                    $type: "button",
                    $text: "Calculate Calories Burned",
                    onclick: function () {
                        App._activeTab = "caloriesburned";
                        App._search();
                    }
                },
                {
                    $type: "div",
                    id: "search-results",
                    $nodes: [
                        // Components for search results will be dynamically injected here
                    ]
                }
            ],
        };

        // routing
        document.addEventListener("DOMContentLoaded", function() {
            document.querySelectorAll("nav ul li a.link").forEach(link => {
                link.addEventListener("click", function(event) {
                    event.preventDefault();
                    const route = event.target.getAttribute("href").substring(1);
                    content._route = route;
                });
            });

            window.addEventListener("popstate", function () {
                const route = window.location.pathname.substring(1);
                content._route = route;
            });
        });        
    </script>
</head>
<body>
    <style>
        /* Add your CSS styles here */
    </style>
    <main>       
        <nav>
            <h1>Demo</h1>
            <ul>
                <li><a class='page' href="/">Home</a></li>
                <li><a class='link' href="/about">About</a></li>
                <li><a class='page' href="/demo.html">Demo</a></li>
                <li><a class='page' href="/users.html">Users</a></li>
                <li><a class='page' href="/test.html">Test</a></li>
                <li><a class='link' href="/blog">Blog</a></li>
            </ul>
        </nav>
        <div id="app"></div>
        <footer>
            <p>Made With &hearts; By Hand</p>
        </footer>
    </main>
    <noscript>
        Turn on JavaScript to access this site content.
    </noscript>
    <script>
        // Initialization or any additional JavaScript can go here
    </script>
</body>
</html>
