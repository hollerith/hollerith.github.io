(function($root){const Container={inject:function(e,t,n,o){let r,i=null;return o&&e?(r=Component.$type(t,n),t.hasOwnProperty("$app")&&(i=e,i.parentNode&&i.parentNode.replaceChild(r,i)),i=r):t.$type&&("head"===t.$type||"body"===t.$type)&&$root.document.getElementsByTagName(t.$type)?i=$root.document.getElementsByTagName(t.$type)[0]:t.id&&$root.document.getElementById(t.id)&&(i=$root.document.getElementById(t.id),i.nodeName.toLowerCase()!==(t.$type||"div")&&(r=Component.$type(t,n),i.parentNode.replaceChild(r,i),i=r)),i&&!i.Meta&&(i.Meta={}),i},add:function(e,t,n,o){const r=Component.$type(t,o);return null!=n&&e.childNodes&&e.childNodes[n]?e.insertBefore(r,e.childNodes[n]):e.appendChild(r),r},build:function(e,t,n,o,r){const i=Container.inject(e,t,o,r);return i||Container.add(e,t,n,o)}},Renderer={set:function(e,t,n){-1===["$init"].indexOf(t)?e.Renderer[t]=Binder.bind(e,n):(n.snapshot=n,e.Renderer[t]=n)},update:function(e,t,n){Binder.queue(e,t,"w"),Renderer.set(e,t,n)},build:function(e,t,n){e.Renderer={},e.Inheritance=n;for(const n in t)Renderer.set(e,n,t[n])},insert:function(e){const t=e.$element;if(!t)return e;const n=Array.isArray(t)?t:[t];return delete e.$element,n.reduce((function(e,t){const n=t(e);if(null===n||"object"!=typeof n)throw new Error("$element not an object");return n.$type=n.$type||"div",n}),e)}},Engine={freeze:function(e){let t=[];const n=JSON.stringify(e,(function(e,n){if("function"==typeof n)return n.toString();if("object"==typeof n&&null!==n){if(-1!==t.indexOf(n))return"[Circular]";t.push(n)}return n}));return t=null,n},LCS:function(e,t){const n=e.length,o=t.length,r=Array.from({length:n+1},(()=>[0]));r[0]=Array.from({length:o+1},(()=>0));const i=e.map((e=>Engine.freeze(e))),c=t.map((e=>Engine.freeze(e)));for(let e=0;e<n;e++)for(let t=0;t<o;t++)r[e+1][t+1]=i[e]===c[t]?r[e][t]+1:Math.max(r[e+1][t],r[e][t+1]);return this.backtrack(r,i,c,n,o)},backtrack:function(e,t,n,o,r){return 0===o||0===r?[]:t[o-1]===n[r-1]?this.backtrack(e,t,n,o-1,r-1).concat({item:t[o-1],_old:o-1,_new:r-1}):e[o][r-1]>e[o-1][r]?this.backtrack(e,t,n,o,r-1):this.backtrack(e,t,n,o-1,r)},diff:function(e,t){const n=this.LCS(e,t),o=n.map((e=>e._old)),r=n.map((e=>e._new));return{"-":e.map(((e,t)=>({item:e,index:t}))).filter((({index:e})=>!o.includes(e))),"+":t.map(((e,t)=>({item:e,index:t}))).filter((({index:e})=>!r.includes(e)))}}},Component={build:function(e,t){Component.$init(e);for(const n in t)null!==t[n]&&void 0!==t[n]&&Component.set(e,n,t[n])},multiline:e=>/\/\*!?(?:@preserve)?[ \t]*(?:\r\n|\n)([\s\S]*?)(?:\r\n|\n)[ \t]*\*\//.exec(e.toString())[1],get:e=>Object.getOwnPropertyDescriptor($root.HTMLElement.prototype,e)||Object.getOwnPropertyDescriptor($root.Element.prototype,e),set:function(e,t,n){if("$"===t[0])if("$type"===t){const t=e.tagName?e.tagName.toLowerCase():"text";if(n.toLowerCase()!==t){const t=Component.$type({$type:"fragment"}).$build(e.Renderer,e.Inheritance,null,e.Meta.namespace);e.parentNode.replaceChild(t,e)}}else"$text"===t?("function"==typeof n&&(n=Component.multiline(n)),e.textContent=n):"$html"===t?("function"==typeof n&&(n=Component.multiline(n)),e.innerHTML=n):"$nodes"===t&&Component.$nodes(e,n);else if("_"===t[0]);else if("value"===t)e[t]=n;else if("style"===t&&"object"==typeof n){const o=Component.get(t).get.call(e);for(const e in n)o[e]=n[e]}else if("number"==typeof n||"string"==typeof n||"boolean"==typeof n)e.setAttribute&&e.setAttribute(t,n);else if("function"==typeof n){const o=Component.get(t);o&&o.set.call(e,n)}},$type:function(e,t){const n={};let o;return"svg"===e.$type?(o=$root.document.createElementNS("http://www.w3.org/2000/svg",e.$type),n.namespace=o.namespaceURI):t?(o=$root.document.createElementNS(t,e.$type),n.namespace=o.namespaceURI):"fragment"===e.$type?o=$root.document.createDocumentFragment():"text"===e.$type?(e.$text&&"function"==typeof e.$text&&(e.$text=Component.multiline(e.$text)),o=$root.document.createTextNode(e.$text)):o=$root.document.createElement(e.$type||"div"),o.Meta=n,o},$nodes:function(e,t){t||(t=[]);const n=[].map.call(e.childNodes,(function(e){return e.Renderer})).filter((function(e){return e}));if(n.length>0){const o=Engine.diff(n,t);o["-"].forEach((function(t){e.childNodes[t.index].Kill=!0})),[].filter.call(e.childNodes,(function(e){return e.Kill})).forEach((function(t){e.removeChild(t)})),o["+"].forEach((function(t){let n=e.Inheritance;for(const t in e.Renderer)"_"===t[0]&&(n=n.concat([t]));e.$build(t.item,n,t.index,e.Meta.namespace),e.$nodes[t.index]=e.childNodes[t.index].Renderer}))}else{const n=Component.$type({$type:"fragment"});let o=e.Inheritance;for(const t in e.Renderer)"_"===t[0]&&(o=o.concat([t]));for(;e.firstChild;)e.removeChild(e.firstChild);t.forEach((function(t){n.$build(t,o,null,e.Meta.namespace)})),e.appendChild(n),e.$nodes=[].map.call(e.childNodes,(function(e){return e.Renderer}))}},$init:function(e){Binder.tick.call($root,(function(){e?.Renderer.$init&&Binder.bind(e,e.Renderer.$init)()}))},$update:function(e){if(e.parentNode&&!e.Meta.$updated&&e.$update){e.Meta.$updated=!0,e.$update();for(const t in e.Dirty)Component.set(e,t,e.Renderer[t]);e.Meta.$updated=!1,e.Dirty=null}}},Binder={tick:$root.requestAnimationFrame||$root.webkitRequestAnimationFrame||$root.mozRequestAnimationFrame||$root.msRequestAnimationFrame||function(e){return $root.setTimeout(e,1e3/60)},set:function(e,t){try{Object.defineProperty(e,t,{configurable:!0,get:function(){let n=null;if("$"===t[0]||"_"===t[0]){if(t in e.Renderer)Binder.queue(e,t,"r"),n=e.Renderer[t];else if("_"===t[0]){let o=e;for(;o=o.parentNode;)o?.Renderer&&t in o.Renderer&&(Binder.queue(o,t,"r"),n=o.Renderer[t])}}else n="value"===t?Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t).get.call(e):"style"===t?Component.get(t).get.call(e):t in e.Renderer?e.Renderer[t]:Component.get(t).get.call(e);return n},set:function(n){let o=e;if(!(t in e.Renderer)&&"_"===t[0])for(;(o=o.parentNode)&&(!o?.Renderer||!(t in o.Renderer)););if(Renderer.update(o,t,n),"$"!==t[0]&&"_"!==t[0]){if("value"===t)return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t).set.call(e,n);"style"===t&&"object"==typeof n?Component.get(t).set.call(e,n):"number"==typeof n||"string"==typeof n||"boolean"==typeof n?e.setAttribute(t,n):"function"==typeof n&&Component.get(t).set.call(e,n)}}})}catch(e){}},build:function(e){["$type","$text","$html","$nodes"].forEach((function(t){t in e.Renderer||Binder.set(e,t)})),e.Inheritance&&e.Inheritance.forEach((function(t){Binder.set(e,t)}));for(const t in e.Renderer)Binder.set(e,t)},_queue:[],bind:function(e,t){if("function"==typeof t){const n=function(){return Binder.tick.call($root,(function(){Binder._queue.forEach((function(e){let t=!1;for(const n in e.Dirty)Engine.freeze(e.Renderer[n])!==e.Dirty[n]&&(Component.set(e,n,e.Renderer[n]),"_"===n[0]&&(t=!0));t&&"$update"in e.Renderer&&"function"==typeof e.Renderer.$update?Component.$update(e):e.Dirty=null}));const t=Binder._queue.indexOf(e);-1!==t&&Binder._queue.splice(t,1)})),t.apply(e,arguments)};return n.snapshot=t,n}return t},queue:function(e,t,n){const o=e.Renderer[t];("r"!==n||"object"==typeof o||Array.isArray(o))&&(-1===Binder._queue.indexOf(e)&&Binder._queue.push(e),e.Dirty||(e.Dirty={}),t in e.Dirty||(e.Dirty[t]=Engine.freeze(e.Renderer[t])))}},Factory={detect:function(e=this){return Object.keys(e).filter((function(t){try{return!(/webkitStorageInfo|webkitIndexedDB/.test(t)||e[t]instanceof $root.Element)&&e[t]?.hasOwnProperty("$app")}catch(e){return!1}})).map((function(t){return e[t]}))},mount:function($context){void 0===$context?$context=$root:$root=$context,$context.DocumentFragment.prototype.$build=$context.Element.prototype.$build=function(e,t,n,o,r){const i=Renderer.insert(e),c=Container.build(this,i,n,o,r);return Renderer.build(c,i,t||[],n),Binder.build(c),Component.build(c,c.Renderer),c},$context.DocumentFragment.prototype.$app=$context.Element.prototype.$app=function(e,t){return this.$build(e,[],null,t?.namespace||null,!0)},$context.DocumentFragment.prototype.$snapshot=$context.Element.prototype.$snapshot=function(){const json=JSON.stringify(this.Renderer,(function(e,t){return"function"==typeof t&&t.snapshot?"("+t.snapshot.toString()+")":t}));return JSON.parse(json,(function(k,v){return"string"==typeof v&&v.indexOf("function")>=0?eval(v):v}))},$root.NodeList&&!$root.NodeList.prototype.forEach&&($root.NodeList.prototype.forEach=Array.prototype.forEach)},create:function(e){return Factory.detect(e).map((function(t){return e.document.body.$build(t,[])}))}};Factory.mount(this),this.addEventListener&&this.addEventListener("load",(function(){Factory.create(this)}))})(this),function($root){const Container={inject:function(e,t,n,o){let r,i=null;return o&&e?(r=Component.$type(t,n),t.hasOwnProperty("$app")&&(i=e,i.parentNode&&i.parentNode.replaceChild(r,i)),i=r):t.$type&&("head"===t.$type||"body"===t.$type)&&$root.document.getElementsByTagName(t.$type)?i=$root.document.getElementsByTagName(t.$type)[0]:t.id&&$root.document.getElementById(t.id)&&(i=$root.document.getElementById(t.id),i.nodeName.toLowerCase()!==(t.$type||"div")&&(r=Component.$type(t,n),i.parentNode.replaceChild(r,i),i=r)),i&&!i.Meta&&(i.Meta={}),i},add:function(e,t,n,o){const r=Component.$type(t,o);return null!=n&&e.childNodes&&e.childNodes[n]?e.insertBefore(r,e.childNodes[n]):e.appendChild(r),r},build:function(e,t,n,o,r){const i=Container.inject(e,t,o,r);return i||Container.add(e,t,n,o)}},Renderer={set:function(e,t,n){-1===["$init"].indexOf(t)?e.Renderer[t]=Binder.bind(e,n):(n.snapshot=n,e.Renderer[t]=n)},update:function(e,t,n){Binder.queue(e,t,"w"),Renderer.set(e,t,n)},build:function(e,t,n){e.Renderer={},e.Inheritance=n;for(const n in t)Renderer.set(e,n,t[n])},insert:function(e){const t=e.$element;if(!t)return e;const n=Array.isArray(t)?t:[t];return delete e.$element,n.reduce((function(e,t){const n=t(e);if(null===n||"object"!=typeof n)throw new Error("$element not an object");return n.$type=n.$type||"div",n}),e)}},Engine={freeze:function(e){let t=[];const n=JSON.stringify(e,(function(e,n){if("function"==typeof n)return n.toString();if("object"==typeof n&&null!==n){if(-1!==t.indexOf(n))return"[Circular]";t.push(n)}return n}));return t=null,n},LCS:function(e,t){const n=e.length,o=t.length,r=Array.from({length:n+1},(()=>[0]));r[0]=Array.from({length:o+1},(()=>0));const i=e.map((e=>Engine.freeze(e))),c=t.map((e=>Engine.freeze(e)));for(let e=0;e<n;e++)for(let t=0;t<o;t++)r[e+1][t+1]=i[e]===c[t]?r[e][t]+1:Math.max(r[e+1][t],r[e][t+1]);return this.backtrack(r,i,c,n,o)},backtrack:function(e,t,n,o,r){return 0===o||0===r?[]:t[o-1]===n[r-1]?this.backtrack(e,t,n,o-1,r-1).concat({item:t[o-1],_old:o-1,_new:r-1}):e[o][r-1]>e[o-1][r]?this.backtrack(e,t,n,o,r-1):this.backtrack(e,t,n,o-1,r)},diff:function(e,t){const n=this.LCS(e,t),o=n.map((e=>e._old)),r=n.map((e=>e._new));return{"-":e.map(((e,t)=>({item:e,index:t}))).filter((({index:e})=>!o.includes(e))),"+":t.map(((e,t)=>({item:e,index:t}))).filter((({index:e})=>!r.includes(e)))}}},Component={build:function(e,t){Component.$init(e);for(const n in t)null!==t[n]&&void 0!==t[n]&&Component.set(e,n,t[n])},multiline:e=>/\/\*!?(?:@preserve)?[ \t]*(?:\r\n|\n)([\s\S]*?)(?:\r\n|\n)[ \t]*\*\//.exec(e.toString())[1],get:e=>Object.getOwnPropertyDescriptor($root.HTMLElement.prototype,e)||Object.getOwnPropertyDescriptor($root.Element.prototype,e),set:function(e,t,n){if("$"===t[0])if("$type"===t){const t=e.tagName?e.tagName.toLowerCase():"text";if(n.toLowerCase()!==t){const t=Component.$type({$type:"fragment"}).$build(e.Renderer,e.Inheritance,null,e.Meta.namespace);e.parentNode.replaceChild(t,e)}}else"$text"===t?("function"==typeof n&&(n=Component.multiline(n)),e.textContent=n):"$html"===t?("function"==typeof n&&(n=Component.multiline(n)),e.innerHTML=n):"$nodes"===t&&Component.$nodes(e,n);else if("_"===t[0]);else if("value"===t)e[t]=n;else if("style"===t&&"object"==typeof n){const o=Component.get(t).get.call(e);for(const e in n)o[e]=n[e]}else if("number"==typeof n||"string"==typeof n||"boolean"==typeof n)e.setAttribute&&e.setAttribute(t,n);else if("function"==typeof n){const o=Component.get(t);o&&o.set.call(e,n)}},$type:function(e,t){const n={};let o;return"svg"===e.$type?(o=$root.document.createElementNS("http://www.w3.org/2000/svg",e.$type),n.namespace=o.namespaceURI):t?(o=$root.document.createElementNS(t,e.$type),n.namespace=o.namespaceURI):"fragment"===e.$type?o=$root.document.createDocumentFragment():"text"===e.$type?(e.$text&&"function"==typeof e.$text&&(e.$text=Component.multiline(e.$text)),o=$root.document.createTextNode(e.$text)):o=$root.document.createElement(e.$type||"div"),o.Meta=n,o},$nodes:function(e,t){t||(t=[]);const n=[].map.call(e.childNodes,(function(e){return e.Renderer})).filter((function(e){return e}));if(n.length>0){const o=Engine.diff(n,t);o["-"].forEach((function(t){e.childNodes[t.index].Kill=!0})),[].filter.call(e.childNodes,(function(e){return e.Kill})).forEach((function(t){e.removeChild(t)})),o["+"].forEach((function(t){let n=e.Inheritance;for(const t in e.Renderer)"_"===t[0]&&(n=n.concat([t]));e.$build(t.item,n,t.index,e.Meta.namespace),e.$nodes[t.index]=e.childNodes[t.index].Renderer}))}else{const n=Component.$type({$type:"fragment"});let o=e.Inheritance;for(const t in e.Renderer)"_"===t[0]&&(o=o.concat([t]));for(;e.firstChild;)e.removeChild(e.firstChild);t.forEach((function(t){n.$build(t,o,null,e.Meta.namespace)})),e.appendChild(n),e.$nodes=[].map.call(e.childNodes,(function(e){return e.Renderer}))}},$init:function(e){Binder.tick.call($root,(function(){e?.Renderer.$init&&Binder.bind(e,e.Renderer.$init)()}))},$update:function(e){if(e.parentNode&&!e.Meta.$updated&&e.$update){e.Meta.$updated=!0,e.$update();for(const t in e.Dirty)Component.set(e,t,e.Renderer[t]);e.Meta.$updated=!1,e.Dirty=null}}},Binder={tick:$root.requestAnimationFrame||$root.webkitRequestAnimationFrame||$root.mozRequestAnimationFrame||$root.msRequestAnimationFrame||function(e){return $root.setTimeout(e,1e3/60)},set:function(e,t){try{Object.defineProperty(e,t,{configurable:!0,get:function(){let n=null;if("$"===t[0]||"_"===t[0]){if(t in e.Renderer)Binder.queue(e,t,"r"),n=e.Renderer[t];else if("_"===t[0]){let o=e;for(;o=o.parentNode;)o?.Renderer&&t in o.Renderer&&(Binder.queue(o,t,"r"),n=o.Renderer[t])}}else n="value"===t?Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t).get.call(e):"style"===t?Component.get(t).get.call(e):t in e.Renderer?e.Renderer[t]:Component.get(t).get.call(e);return n},set:function(n){let o=e;if(!(t in e.Renderer)&&"_"===t[0])for(;(o=o.parentNode)&&(!o?.Renderer||!(t in o.Renderer)););if(Renderer.update(o,t,n),"$"!==t[0]&&"_"!==t[0]){if("value"===t)return Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),t).set.call(e,n);"style"===t&&"object"==typeof n?Component.get(t).set.call(e,n):"number"==typeof n||"string"==typeof n||"boolean"==typeof n?e.setAttribute(t,n):"function"==typeof n&&Component.get(t).set.call(e,n)}}})}catch(e){}},build:function(e){["$type","$text","$html","$nodes"].forEach((function(t){t in e.Renderer||Binder.set(e,t)})),e.Inheritance&&e.Inheritance.forEach((function(t){Binder.set(e,t)}));for(const t in e.Renderer)Binder.set(e,t)},_queue:[],bind:function(e,t){if("function"==typeof t){const n=function(){return Binder.tick.call($root,(function(){Binder._queue.forEach((function(e){let t=!1;for(const n in e.Dirty)Engine.freeze(e.Renderer[n])!==e.Dirty[n]&&(Component.set(e,n,e.Renderer[n]),"_"===n[0]&&(t=!0));t&&"$update"in e.Renderer&&"function"==typeof e.Renderer.$update?Component.$update(e):e.Dirty=null}));const t=Binder._queue.indexOf(e);-1!==t&&Binder._queue.splice(t,1)})),t.apply(e,arguments)};return n.snapshot=t,n}return t},queue:function(e,t,n){const o=e.Renderer[t];("r"!==n||"object"==typeof o||Array.isArray(o))&&(-1===Binder._queue.indexOf(e)&&Binder._queue.push(e),e.Dirty||(e.Dirty={}),t in e.Dirty||(e.Dirty[t]=Engine.freeze(e.Renderer[t])))}},Factory={detect:function(e=this){return Object.keys(e).filter((function(t){try{return!(/webkitStorageInfo|webkitIndexedDB/.test(t)||e[t]instanceof $root.Element)&&e[t]?.hasOwnProperty("$app")}catch(e){return!1}})).map((function(t){return e[t]}))},mount:function($context){void 0===$context?$context=$root:$root=$context,$context.DocumentFragment.prototype.$build=$context.Element.prototype.$build=function(e,t,n,o,r){const i=Renderer.insert(e),c=Container.build(this,i,n,o,r);return Renderer.build(c,i,t||[],n),Binder.build(c),Component.build(c,c.Renderer),c},$context.DocumentFragment.prototype.$app=$context.Element.prototype.$app=function(e,t){return this.$build(e,[],null,t?.namespace||null,!0)},$context.DocumentFragment.prototype.$snapshot=$context.Element.prototype.$snapshot=function(){const json=JSON.stringify(this.Renderer,(function(e,t){return"function"==typeof t&&t.snapshot?"("+t.snapshot.toString()+")":t}));return JSON.parse(json,(function(k,v){return"string"==typeof v&&v.indexOf("function")>=0?eval(v):v}))},$root.NodeList&&!$root.NodeList.prototype.forEach&&($root.NodeList.prototype.forEach=Array.prototype.forEach)},create:function(e){return Factory.detect(e).map((function(t){return e.document.body.$build(t,[])}))}};Factory.mount(this),this.addEventListener&&this.addEventListener("load",(function(){Factory.create(this)}))}(this);
